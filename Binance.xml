<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="Binance" Id="Binance" Category="Finance" RequireVersion="7.0"
       SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Binance.xml"
       HelpUrl="http://seotoolsforexcel.com/binance" HelpText="Documentation">

  <Author Name="Dovydas Meilunas" Url="https://github.com/dovydasm"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/binance/">
    <Text Id="ApiKey" Title="API Key" Required="false" HelpUrl="http://seotoolsforexcel.com/binance"/>
  </Settings>

  <Resources>
    <Resource Id="ApiKeyRequired">
      <Fail>
        <Compute>
          <Compute.Expr>
            <![CDATA[
              @{
                @if(string.IsNullOrEmpty(Model.ApiKey)){
                throw new Exception("API key required. Click \"Settings\" in the connector and enter your API key");
                }
              }
            ]]>
          </Compute.Expr>
        </Compute>
      </Fail>
    </Resource>
    <Resource Id="Error">
      <Fail>
        <JsonPath Expr="$.msg" Id="Error"/>
      </Fail>
    </Resource>
  </Resources>

  <RestConnector Id="ExchangeInfo" Title="Exchange Info" HelpText="List all supported trading pairs" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#exchange-information">
    <Fetch Url="https://api.binance.com/api/v1/exchangeInfo"/>
    <Parse>
      <JsonPath Expr="$.symbols.*" Id="Symbol" Title="Symbol">
        <JsonPath Expr="symbol" Id="Symbol" Title="Symbol" Converter="String"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="baseAsset" Id="BaseAsset" Title="Base Asset" Converter="String"/>
        <JsonPath Expr="baseAssetPrecision" Id="BasePrecision" Title="Base Asset Precision" Converter="Int" Checked="False"/>
        <JsonPath Expr="quoteAsset" Id="QupteAsset" Title="Quote Asset" Converter="String"/>
        <JsonPath Expr="quotePrecision" Id="QuotePrecision" Title="Quote Precision" Converter="Int" Checked="False"/>
        <JsonPath Expr="icebergAllowed" Id="IcebergAllowed" Title="Iceberg Orders Allowed" Converter="Bool" Checked="False"/>
        <JsonPath Expr="filters.*.minPrice" Id="MinPrice" Title="Minimum Price" Converter="Double"/>
        <JsonPath Expr="filters.*.maxPrice" Id="MaxPrice" Title="Maximum Price" Converter="Double"/>
        <JsonPath Expr="filters.*.tickSize" Id="TickSize" Title="Tick Size" Converter="Double"/>
        <JsonPath Expr="filters.*.minQty" Id="MinQty" Title="Minimum Quantity" Converter="Double"/>
        <JsonPath Expr="filters.*.maxQty" Id="MaxQty" Title="Maximum Quantity" Converter="Double"/>
        <JsonPath Expr="filters.*.stepSize" Id="StepSize" Title="Step Size" Converter="Double"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="ListSymbolsHidden" Title="ListSymbolsHidden" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#exchange-information" Hidden="true">
    <Fetch Url="https://api.binance.com/api/v1/exchangeInfo"/>
    <Parse>
      <JsonPath Expr="$.symbols.*" Id="Symbol" Title="Symbol">
        <JsonPath Expr="symbol" Id="Symbol" Title="Symbol" Converter="String"/>
        <JsonPath Expr="symbol" Id="SymbolName" Title="Symbol" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="OrderBook" Title="Order Book" HelpText="List of open orders for specified symbol" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#order-book">
    <Parameters>
      <Text Id="Symbol" Title="Trading pair symbol (e.g. ETHBTC)" DefaultValue="" Required="true" Select.Connector="ListSymbolsHidden" Select.IdField="Symbol" Select.TitleField="SymbolName" Debug.DefaultValue="ETHBTC"/>
      <Number Id="Limit" Title="Limit (increments of 5)" DefaultValue="100" Min="5" Max="1000" Required="false" HelpText=""/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.binance.com/api/v1/depth?
        symbol=@Model.Symbol
        @if(Model.Limit % 5 == 0)
        {
          @: &limit=@Model.Limit
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.bids.*" Id="Bids">
        <JsonPath Expr="$[0]" Id="BidPrice" Title="Bid Price" Converter="Double"/>
        <JsonPath Expr="$[1]" Id="BidQty" Title="Bid Quantity" Converter="Double"/>
      </JsonPath>
      <JsonPath Expr="$.asks.*" Id="Asks">
        <JsonPath Expr="$[0]" Id="AskPrice" Title="Ask Price" Converter="Double"/>
        <JsonPath Expr="$[1]" Id="AskQty" Title="Ask Qty" Converter="Double"/>
      </JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="RecentTradesList" Title="Recent Trades List" HelpText="List recently made trades for specific symbol" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#recent-trades-list">
    <Parameters>
      <Text Id="Symbol" Title="Trading pair symbol (e.g. ETHBTC)" DefaultValue="" Required="true" Select.Connector="ListSymbolsHidden" Select.IdField="Symbol" Select.TitleField="SymbolName" Debug.DefaultValue="ETHBTC"/>
      <Number Id="Limit" Title="Limit (increments of 5)" DefaultValue="500" Min="5" Max="500" Required="false" HelpText=""/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.binance.com/api/v1/trades?
        symbol=@Model.Symbol
        @if(Model.Limit % 5 == 0)
        {
          @: &limit=@Model.Limit
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.*" Id="Trades">
        <JsonPath Expr="id" Id="TradeId" Title="Id" Converter="Int" Checked="False"/>
        <JsonPath Expr="price" Id="Price" Title="Price" Converter="Double"/>
        <JsonPath Expr="qty" Id="Quantity" Title="Quantity" Converter="Double"/>
        <Compute Id="Time" Title="Time" Converter="DateTime">
          <Compute.Expr>
            <![CDATA[
              @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
          </Compute.Expr>
          <JsonPath Expr="time" Id="Inp" DefaultValue=""/>
        </Compute>
        <JsonPath Expr="isBuyerMaker" Id="BuyerIsMaker" Title="Buyer is Maker" Converter="Bool"/>
        <JsonPath Expr="isBestMatch" Id="IsBestMatch" Title="Best Match" Converter="Bool"/>
      </JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AggregateTradesList" Title="Aggregate Trades List" HelpText="List compressed, aggregate trades" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#compressedaggregate-trades-list">
    <Parameters>
      <Text Id="Symbol" Title="Trading pair symbol (e.g. ETHBTC)" DefaultValue="" Required="true" Select.Connector="ListSymbolsHidden" Select.IdField="Symbol" Select.TitleField="SymbolName" Debug.DefaultValue="ETHBTC"/>
      <Number Id="Limit" Title="Limit (increments of 5)" DefaultValue="500" Min="5" Max="500" Required="false" HelpText=""/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.binance.com/api/v1/aggTrades?
        symbol=@Model.Symbol
        @if(Model.Limit % 5 == 0)
        {
          @: &limit=@Model.Limit
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.*" Id="Trades">
        <JsonPath Expr="a" Id="AggregateTradeId" Title="Aggregate Trade Id" Converter="Int" Checked="False"/>
        <JsonPath Expr="p" Id="Price" Title="Price" Converter="Double"/>
        <JsonPath Expr="q" Id="Quantity" Title="Quantity" Converter="Double"/>
        <JsonPath Expr="f" Id="FirstTradeId" Title="First Trade Id" Converter="Int" Checked="False"/>
        <JsonPath Expr="l" Id="LastTradeId" Title="Last Trade Id" Converter="Int" Checked="False"/>
        <Compute Id="Time" Title="Time" Converter="DateTime">
          <Compute.Expr>
            <![CDATA[
             @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
          </Compute.Expr>
          <JsonPath Expr="T" Id="Inp" DefaultValue=""/>
        </Compute>
        <JsonPath Expr="m" Id="BuyerIsMaker" Title="Buyer is Maker" Converter="Bool"/>
        <JsonPath Expr="M" Id="IsBestMatch" Title="Best Match" Converter="Bool"/>
      </JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="TwentyFourHourStatistics" Title="24 Hour price change statistics" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#compressedaggregate-trades-list">
    <Parameters>
      <Text Id="Symbol" Title="Trading pair symbol (e.g. ETHBTC)" DefaultValue="" Required="false" Select.Connector="ListSymbolsHidden" Select.IdField="Symbol" Select.TitleField="SymbolName" Debug.DefaultValue="ETHBTC"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.binance.com/api/v1/ticker/24hr
        @if(!string.IsNullOrEmpty(Model.Symbol)){
         @: ?symbol=@Model.Symbol
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="symbol" Id="symbol" Title="Symbol" Converter="String"/>
      <JsonPath Expr="priceChange" Id="PriceChange" Title="Price Change" Converter="Double"/>
      <JsonPath Expr="priceChangePercent" Id="PriceChangePercent" Title="Price Change Percent" Converter="Double"/>
      <JsonPath Expr="weightedAvgPrice" Id="WeightedAvgPrice" Title="Weighted Avg Price" Converter="Double"/>
      <JsonPath Expr="prevClosePrice" Id="PrevClosePrice" Title="Prev Close Price" Converter="Double"/>
      <JsonPath Expr="lastPrice" Id="LastPrice" Title="Last Price" Converter="Double"/>
      <JsonPath Expr="lastQty" Id="LastQty" Title="Last Qty" Converter="Double"/>
      <JsonPath Expr="bidPrice" Id="BidPrice" Title="Bid Price" Converter="Double"/>
      <JsonPath Expr="bidQty" Id="BidQty" Title="Bid Qty" Converter="Double"/>
      <JsonPath Expr="askPrice" Id="AskPrice" Title="Ask Price" Converter="Double"/>
      <JsonPath Expr="askQty" Id="AskQty" Title="Ask Qty" Converter="Double"/>
      <JsonPath Expr="openPrice" Id="OpenPrice" Title="Open Price" Converter="Double"/>
      <JsonPath Expr="highPrice" Id="HighPrice" Title="High Price" Converter="Double"/>
      <JsonPath Expr="lowPrice" Id="LowPrice" Title="Low Price" Converter="Double"/>
      <JsonPath Expr="volume" Id="Volume" Title="Volume" Converter="Double"/>
      <JsonPath Expr="quoteVolume" Id="QuoteVolume" Title="Quote Volume" Converter="Double"/>
      <JsonPath Expr="firstId" Id="FirstId" Title="First Id" Converter="Int" Checked="False"/>
      <JsonPath Expr="lastId" Id="LastId" Title="Last Id" Converter="Int" Checked="False"/>
      <JsonPath Expr="count" Id="Count" Title="Count" Converter="Int"/>
      <Compute Id="OpenTime" Title="Open Time" Converter="DateTime" Checked="False">
        <Compute.Expr>
          <![CDATA[
             @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
        </Compute.Expr>
        <JsonPath Expr="openTime" Id="Inp" DefaultValue=""/>
      </Compute>
      <Compute Id="CloseTime" Title="Close Time" Converter="DateTime">
        <Compute.Expr>
          <![CDATA[
             @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
        </Compute.Expr>
        <JsonPath Expr="closeTime" Id="Inp" DefaultValue="" Checked="False"/>
      </Compute>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="TwentyFourHourStatisticsAll" Title="24 Hour price change statistics (all symbols)" HelpUrl="https://github.com/binance-exchange/binance-official-api-docs/blob/master/rest-api.md#compressedaggregate-trades-list">
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.binance.com/api/v1/ticker/24hr
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.*" Id="Trades">
        <JsonPath Expr="symbol" Id="symbol" Title="Symbol" Converter="String"/>
        <JsonPath Expr="priceChange" Id="PriceChange" Title="Price Change" Converter="Double"/>
        <JsonPath Expr="priceChangePercent" Id="PriceChangePercent" Title="Price Change Percent" Converter="Double"/>
        <JsonPath Expr="weightedAvgPrice" Id="WeightedAvgPrice" Title="Weighted Avg Price" Converter="Double"/>
        <JsonPath Expr="prevClosePrice" Id="PrevClosePrice" Title="Prev Close Price" Converter="Double"/>
        <JsonPath Expr="lastPrice" Id="LastPrice" Title="Last Price" Converter="Double"/>
        <JsonPath Expr="lastQty" Id="LastQty" Title="Last Qty" Converter="Double"/>
        <JsonPath Expr="bidPrice" Id="BidPrice" Title="Bid Price" Converter="Double"/>
        <JsonPath Expr="bidQty" Id="BidQty" Title="Bid Qty" Converter="Double"/>
        <JsonPath Expr="askPrice" Id="AskPrice" Title="Ask Price" Converter="Double"/>
        <JsonPath Expr="askQty" Id="AskQty" Title="Ask Qty" Converter="Double"/>
        <JsonPath Expr="openPrice" Id="OpenPrice" Title="Open Price" Converter="Double"/>
        <JsonPath Expr="highPrice" Id="HighPrice" Title="High Price" Converter="Double"/>
        <JsonPath Expr="lowPrice" Id="LowPrice" Title="Low Price" Converter="Double"/>
        <JsonPath Expr="volume" Id="Volume" Title="Volume" Converter="Double"/>
        <JsonPath Expr="quoteVolume" Id="QuoteVolume" Title="Quote Volume" Converter="Double"/>
        <JsonPath Expr="firstId" Id="FirstId" Title="First Id" Converter="Int" Checked="False"/>
        <JsonPath Expr="lastId" Id="LastId" Title="Last Id" Converter="Int" Checked="False"/>
        <JsonPath Expr="count" Id="Count" Title="Count" Converter="Int"/>
        <Compute Id="OpenTime" Title="Open Time" Converter="DateTime" Checked="False">
          <Compute.Expr>
            <![CDATA[
             @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
          </Compute.Expr>
          <JsonPath Expr="openTime" Id="Inp" DefaultValue=""/>
        </Compute>
        <Compute Id="CloseTime" Title="Close Time" Converter="DateTime">
          <Compute.Expr>
            <![CDATA[
             @{
                long epoch = Convert.ToInt64(Model.Inp);
                System.DateTime dtDateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
                dtDateTime = dtDateTime.AddMilliseconds(epoch);
                string formatted = dtDateTime.ToString();
              }
              @(formatted)
            ]]>
          </Compute.Expr>
          <JsonPath Expr="closeTime" Id="Inp" DefaultValue="" Checked="False"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

</Suite>