<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="SEO" Title="Ahrefs" Id="Ahrefs" RequireVersion="8.2" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Ahrefs.xml" HelpUrl="http://seotoolsforexcel.com/ahrefs/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity" />
	
	<SeoToolsAuthenticator StayAuthenticated="true" Key="ahrefs"/>

  <Resources>
    <Resource Id="HttpSettings">
      <HttpSettings>
				<RequestContentType>application/json</RequestContentType>
        <RequestHeaders>
          <Header Name="Authorization">Bearer @(Model.Authenticator.Token)</Header>
        </RequestHeaders>
      </HttpSettings>
    </Resource>
    <Resource Id="Fail">
			<Fail>
				<JsonPath Expr="error"/>
				<JsonPath Expr="[1]" Id="AuthFail" Fail.If="IsEqual" Fail.ComparedTo="Forbidden" Fail.Action="Message" Fail.Message="Forbidden" />
				<JsonPath Expr="[0]" Id="OtherFail" Fail.If="IsEqual" Fail.ComparedTo="Error" Fail.Action="Message" Fail.Message="Error" />
			</Fail>
    </Resource>
    <Resource Id="Mode">
      <Select Id="Mode" Title="Mode" DefaultValue="subdomains">
        <DataSource>
          <Item Id="exact" Title="URL (exact url)"/>
          <Item Id="domain" Title="Domain without subdomains (domain/*)"/>
          <Item Id="subdomains" Title="Domain with all subdomains (*.domain/*)"/>
          <Item Id="prefix" Title="Prefix (domain.com/path/*)"/>
        </DataSource>
      </Select>
    </Resource>
    <Resource Id="Country">
      <Select Id="Country" Title="Country Store" DefaultValue="us">
        <DataSource>
					<Item Id="Global"/>
          <ISOCountryCodes/>
        </DataSource>
      </Select>
    </Resource>
		<Resource Id="HistoryGrouping">
      <Select Id="HistoryGrouping" Title="History Grouping" DefaultValue="monthly">
        <DataSource>
          <Item Id="daily" Title="Daily"/>
          <Item Id="weekly" Title="Weekly"/>
          <Item Id="monthly" Title="Monthly"/>
        </DataSource>
      </Select>
		</Resource>
		<Resource Id="VolumeMode">
      <Select Id="VolumeMode" Title="Volume Mode" DefaultValue="monthly">
        <DataSource>
          <Item Id="monthly" Title="Monthly"/>
          <Item Id="average" Title="Average"/>
        </DataSource>
      </Select>
		</Resource>
	</Resources>

  <RestConnector Id="DomainRating" Title="Domain Rating" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-domain-rating">
    <Parameters>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<Date Id="Date" Title="Date"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/domain-rating
				?target=@Model.Target
				&date=@Model.Date.ToString("yyyy-MM-dd")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="domain_rating.domain_rating" Id="DomainRating" Title="Domain Rating" Converter="Double"/>
      <JsonPath Expr="domain_rating.ahrefs_rank" Id="AhrefsRank" Title="Ahrefs Rank" Converter="Int"/>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="BacklinksStats" Title="Backlinks Stats" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/list-backlinks-stats">
    <Parameters>
			<Resource Id="Mode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<Date Id="Date" Title="Date"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/backlinks-stats
				?target=@Model.Target
				&mode=@Model.Mode
				&date=@Model.Date.ToString("yyyy-MM-dd")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="metrics.live" Id="Live" Title="Live" Converter="Int"/>
      <JsonPath Expr="metrics.all_time" Id="AllTime" Title="All Time" Converter="Int"/>
      <JsonPath Expr="metrics.live_refdomains" Id="LiveRefdomains" Title="Live Refdomains" Converter="Int"/>
      <JsonPath Expr="metrics.all_time_refdomains" Id="AllTimeRefdomains" Title="All Time Ref domains" Converter="Int"/>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="OutlinksStats" Title="Outlinks Stats" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/list-outlinks-stats">
    <Parameters>
			<Resource Id="Mode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<Date Id="Date" Title="Date"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/outlinks-stats
				?target=@Model.Target
				&mode=@Model.Mode
				&date=@Model.Date.ToString("yyyy-MM-dd")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="metrics.outgoing_links" Id="OutgoingLinks" Title="Outgoing Links" Converter="Int"/>
      <JsonPath Expr="metrics.outgoing_links_dofollow" Id="OutgoingLinksDofollow" Title="Outgoing Links Dofollow" Converter="Int"/>
      <JsonPath Expr="metrics.linked_domains" Id="LinkedDomains" Title="Linked Domains" Converter="Int"/>
      <JsonPath Expr="metrics.linked_domains_dofollow" Id="LinkedDomainsDofollow" Title="Linked Domains Dofollow" Converter="Int"/>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="Metrics" Title="Metrics" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/list-metrics">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
      <Resource Id="VolumeMode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<Date Id="Date" Title="Date"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/metrics
				?target=@Model.Target
				&mode=@Model.Mode
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
				&date=@Model.Date.ToString("yyyy-MM-dd")
				&volume_mode=@Model.VolumeMode
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="metrics.org_keywords" Id="OrganicKeywords" Title="Organic Keywords" Converter="Int"/>
      <JsonPath Expr="metrics.paid_keywords" Id="PaidKeywords" Title="Paid Keywords" Converter="Int"/>
      <JsonPath Expr="metrics.org_keywords_1_3" Id="OrganicKeywords13" Title="Organic Keywords Top3 Results" Converter="Int"/>
      <JsonPath Expr="metrics.org_traffic" Id="OrganicTraffic" Title="Organic Traffic" Converter="Int"/>
      <JsonPath Expr="metrics.org_cost" Id="OrganicCost" Title="Organic Cost" Converter="Int"/>
      <JsonPath Expr="metrics.paid_traffic" Id="PaidTraffic" Title="Paid Traffic" Converter="Int"/>
      <JsonPath Expr="metrics.paid_cost" Id="PaidCost" Title="Paid Cost" Converter="Int"/>
      <JsonPath Expr="metrics.paid_pages" Id="PaidPages" Title="Paid Pages" Converter="Int"/>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="RefdomainsHistory" Title="Refdomains History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-refdomains-history">
    <Parameters>
      <Resource Id="HistoryGrouping"/>
			<Resource Id="Mode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/refdomains-history
				?target=@Model.Target
				&mode=@Model.Mode
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.refdomains[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(refdomains[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="DomainRatingHistory" Title="Domain Rating History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-domain-rating-history">
    <Parameters>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/domain-rating-history
				?target=@Model.Target
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.domain_ratings[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(domain_ratings[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="UrlRatingHistory" Title="URL Rating History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-url-rating-history">
    <Parameters>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/url-rating-history
				?target=@Model.Target
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.url_ratings[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(url_ratings[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="PagesHistory" Title="Pages History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-pages-history">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/pages-history
				?target=@Model.Target
				&mode=@Model.Mode
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.pages[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(pages[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="MetricsHistory" Title="Metrics History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-metrics-history">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
			<Resource Id="VolumeMode"/>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/metrics-history
				?target=@Model.Target
				&mode=@Model.Mode
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
				&volume_mode=@Model.VolumeMode
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.metrics[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(metrics[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="KeywordsHistory" Title="Keywords History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-keywords-history">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
			<Resource Id="VolumeMode"/>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/keywords-history
				?target=@Model.Target
				&mode=@Model.Mode
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&history_grouping=@Model.HistoryGrouping
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
				&volume_mode=@Model.VolumeMode
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.keywords[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(keywords[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="MetricsByCountry" Title="Metrics by Country" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-metrics-by-country">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="VolumeMode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<Date Id="Date" Title="Date"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/metrics-by-country
				?target=@Model.Target
				&mode=@Model.Mode
				&date=@Model.Date.ToString("yyyy-MM-dd")
				&volume_mode=@Model.VolumeMode
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.metrics[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(metrics[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>
	
  <RestConnector Id="PagesByTraffic" Title="Pages by Traffic" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-pages-by-traffic">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
			<Resource Id="VolumeMode"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/pages-by-traffic
				?target=@Model.Target
				&mode=@Model.Mode
				&volume_mode=@Model.VolumeMode
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="metrics.outgoing_links" Id="OutgoingLinks" Title="Outgoing Links" Converter="Int"/>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="TotalSearchVolumeHistory" Title="Total Search Volume History" Group="Site Explorer" HelpUrl="https://docs.ahrefs.com/docs/api/site-explorer/operations/get-a-total-search-volume-history">
    <Parameters>
			<Resource Id="Mode"/>
			<Resource Id="Country"/>
			<Resource Id="VolumeMode"/>
			<Resource Id="HistoryGrouping"/>
      <Text Id="Target" Title="Target" Debug.DefaultValue="ahrefs.com" Required="true"/>
			<DateInterval Id="DateInterval" Title="Interval" DefaultValue="LastYear"/>
    </Parameters>
    <Fetch>
			<Resource Id="HttpSettings"/>
      <Fetch.Url>
        <![CDATA[
        https://api.ahrefs.com/v3/site-explorer/total-search-volume-history
				?target=@Model.Target
				&mode=@Model.Mode
				&date_from=@(((DateTimeOffset)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
				&date_to=@(((DateTimeOffset)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
				&volume_mode=@Model.VolumeMode
				&history_grouping=@Model.HistoryGrouping
				@(Model.Country != "Global" ? "&country=" + Model.Country : "")
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<Table DefaultConverter="auto">
				<JsonPath Id="Headers" Expr="keys($.metrics[0])">
					<JsonPath Expr="key"/>
				</JsonPath>
				<JsonPath Id="Cells" Expr="keys(metrics[*])" DefaultValue="">
					<JsonPath Expr="value"/>
				</JsonPath>
			</Table>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

</Suite>
