<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="HubSpot" RequireVersion="6.1.2" Id="HubSpot" Category="CRM" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/HubSpot.xml" HelpUrl="http://seotoolsforexcel.com/HubSpot/" HelpText="Documentation">

  <Author Name="Victor" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/HubSpot/">
    <Text Id="AccessToken" Title="Access Token" Required="true" HelpUrl="http://seotoolsforexcel.com/HubSpot/"/>
  </Settings>

  <RestConnector Id="Contacts" Title="Contacts" Hidden="false" HelpText="Returns all contacts that have been created in the portal.">
    <Parameters>
      <Checkbox Id="ReturnRecent" Title="Return Recently Modified Only" DefaultValue="false"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="VidOffset" Expr="vid-offset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/lists/
        @if(Model.ReturnRecent == false)
        {
          @: all/contacts/all
        }
        else
        {
          @: recently_updated/contacts/recent
        }
        ?hapikey=@(Model.AccessToken)
        &property=@(SelectedContactFields())
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0 && Model.HasMore == "true")
        {
          @: &vidOffset=@(Model.VidOffset)
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="contacts.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties.firstname.value" Id="FirstName" Title="First Name" Tag="firstname" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.lastname.value" Id="LastName" Title="Last Name" Tag="lastname" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.company.value" Id="Company" Title="Company" Tag="company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.phone.value" Id="Phone" Title="Phone" Converter="String" Tag="phone" HelpText="Phone Number of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.num_associated_deals.value" Id="Deals" Title="Deals" Converter="Int" Tag="num_associated_deals" HelpText="Number of associated deals" DefaultValue="0"/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" Tag="lastmodifieddate" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.lastmodifieddate.value" Id="LastModified" Converter="Long"/>
        </Compute>
        <Compute Id="Added" Title="Added" Converter="DateTime" HelpText="The Timestamp when contact was created." DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.AddedAt))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="addedAt" Id="AddedAt" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonical-vid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
        <JsonPath Expr="profile-url" Id="ProfileUrl" Title="Profile URL" Converter="String" HelpText="A URL that can be used to view the contact data without logging in. Anyone with this link would be able to view (but not edit) the record"/>
        <Compute Id="MergedIds" Title="Merged Ids"  Converter="String" HelpText="A list of vids that have been merged into this contact record." Checked="false">
          <Compute.Expr>
            <![CDATA[
            @{
              var temp = Regex.Replace(Model.MergedIds, @"\s+", " ");
              var stripped = temp.Substring(1,temp.Length-2);
            }
            @stripped
            ]]>
          </Compute.Expr>
        <JsonPath Expr="merged-vids" Id="MergedIds" Converter="String"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactsbyId" Title="Contacts by Id" Hidden="false" HelpText="Returns information about one or more contacts by their unique ID's.">
    <Parameters>
      <Text Id="ContactIds" Title="Contact Ids" Debug.DefaultValue="3842424" HelpText="Enter one or more Contact Ids separated by a new line" Required="true" Multiline="true"/>
      <Checkbox Id="IncludeDeleted" Title="Include Deleted Contacts" DefaultValue="false"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/contact/vids/batch/
        ?hapikey=@(Model.AccessToken)
        &vid=@(FetchContactIdString())
        @if(Model.IncludeDeleted == true)
        {
          @: &includeDeletes=true
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties.firstname.value" Id="FirstName" Title="First Name" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.lastname.value" Id="LastName" Title="Last Name" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.company.value" Id="Company" Title="Company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.lastmodifieddate.value" Id="LastModified" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonical-vid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
        <JsonPath Expr="profile-url" Id="ProfileUrl" Title="Profile URL" Converter="String" HelpText="A URL that can be used to view the contact data without logging in. Anyone with this link would be able to view (but not edit) the record"/>
        <Compute Id="MergedIds" Title="Merged Ids"  Converter="String" HelpText="A list of vids that have been merged into this contact record." Checked="false">
          <Compute.Expr>
            <![CDATA[
            @{
              var temp = Regex.Replace(Model.MergedIds, @"\s+", " ");
              var stripped = temp.Substring(1,temp.Length-2);
            }
            @stripped
            ]]>
          </Compute.Expr>
        <JsonPath Expr="merged-vids" Id="MergedIds" Converter="String"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactbyEmail" Title="Contacts by Email" Hidden="false" HelpText="Returns information about one or more contacts by their E-mail addresses.">
    <Parameters>
      <Text Id="ContactEmails" Title="Contact Email Address" Debug.DefaultValue="email_abc9bd5cdf@abctest.com" Required="true" HelpText="Enter one or more Email addresses separated by a new line" Multiline="true"/>
      <Checkbox Id="IncludeDeleted" Title="Include Deleted Contacts" DefaultValue="false"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/contact/emails/batch/
        ?email=@(FetchContactEmailString())/profile
        &hapikey=@(Model.AccessToken)
        @if(Model.IncludeDeleted == true)
        {
          @: &includeDeletes=true
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties.firstname.value" Id="FirstName" Title="First Name" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.lastname.value" Id="LastName" Title="Last Name" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.company.value" Id="Company" Title="Company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.lastmodifieddate.value" Id="LastModified" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonical-vid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
        <JsonPath Expr="profile-url" Id="ProfileUrl" Title="Profile URL" Converter="String" HelpText="A URL that can be used to view the contact data without logging in. Anyone with this link would be able to view (but not edit) the record"/>
        <Compute Id="MergedIds" Title="Merged Ids"  Converter="String" HelpText="A list of vids that have been merged into this contact record." Checked="false">
          <Compute.Expr>
            <![CDATA[
            @{
              var temp = Regex.Replace(Model.MergedIds, @"\s+", " ");
              var stripped = temp.Substring(1,temp.Length-2);
            }
            @stripped
            ]]>
          </Compute.Expr>
        <JsonPath Expr="merged-vids" Id="MergedIds" Converter="String"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactsSearch" Title="Contacts Search" Hidden="false" HelpText="Returns contacts by the contact's email address, first and last name, and company name.">
    <Parameters>
      <Text Id="Query" Title="Query" Debug.DefaultValue="portal" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/search/query?
        q=@(Utils.UrlEncode(Model.Query))
        &hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        &offset=@(Model.PageCursor.NextSkip)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="contacts.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties.firstname.value" Id="FirstName" Title="First Name" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.lastname.value" Id="LastName" Title="Last Name" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.company.value" Id="Company" Title="Company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.lastmodifieddate.value" Id="LastModified" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonical-vid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
        <JsonPath Expr="profile-url" Id="ProfileUrl" Title="Profile URL" Converter="String" HelpText="A URL that can be used to view the contact data without logging in. Anyone with this link would be able to view (but not edit) the record"/>
        <Compute Id="MergedIds" Title="Merged Ids"  Converter="String" HelpText="A list of vids that have been merged into this contact record." Checked="false">
          <Compute.Expr>
            <![CDATA[
            @{
              var temp = Regex.Replace(Model.MergedIds, @"\s+", " ");
              var stripped = temp.Substring(1,temp.Length-2);
            }
            @stripped
            ]]>
          </Compute.Expr>
        <JsonPath Expr="merged-vids" Id="MergedIds" Converter="String"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactsLists" Title="Contact Lists" Hidden="false" HelpText="Returns the contact lists for a portal.">
    <Parameters>
      <Radio Id="ListType" Title="Filter by List Type" DefaultValue="all" Required="false">
        <DataSource>
          <Item Id="all" Title="All"/>
          <Item Id="static" Title="Static"/>
          <Item Id="dynamic" Title="Dynamic"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Paging PageSize="100" EvenPages="false"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/lists
        @if(Model.ListType != "all")
        {
          @: /@(Model.ListType)
        }
        ?hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        &offset=@(Model.PageCursor.NextSkip)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="lists.*">
        <JsonPath Expr="listId" Id="ListId" Title="List Id" Converter="Int" HelpText="The unique ID of the list."/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="The name of the list."/>
        <JsonPath Expr="metaData.size" Id="Contacts" Title="Contacts" Converter="Int" HelpText="The number of contacts in the list."/>
        <JsonPath Expr="listType" Id="ListType" Title="Type" Converter="String" HelpText="One of DYNAMIC or STATIC"/>
        <Compute Id="Updated" Title="Updated" Converter="DateTime" HelpText="The Timestamp when the list was last updated.">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.UpdatedAt))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="updatedAt" Id="UpdatedAt" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" HelpText="The Timestamp when the list was created.">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedAt))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="createdAt" Id="CreatedAt" Converter="Long"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactListsbyId" Title="Contact Lists by Id" Hidden="false" HelpText="Returns one or more contact lists that you specify with list Ids.">
    <Parameters>
      <Text Id="ContactListsIds" Title="Contact Lists Ids" Debug.DefaultValue="229998" Required="true"  HelpText="Enter one or more Contact List Ids separated by a new line"  Multiline="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/lists/batch?
        listId=@(FetchContactListString())
        &hapikey=@(Model.AccessToken)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="lists.*">
        <JsonPath Expr="listId" Id="ListId" Title="List Id" Converter="Int" HelpText="The unique ID of the list."/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="The name of the list."/>
        <JsonPath Expr="metaData.size" Id="Contacts" Title="Contacts" Converter="Int" HelpText="The number of contacts in the list."/>
        <JsonPath Expr="listType" Id="ListType" Title="Type" Converter="String" HelpText="One of DYNAMIC or STATIC"/>
        <Compute Id="Updated" Title="Updated" Converter="DateTime" HelpText="The Timestamp when the list was last updated.">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.UpdatedAt))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="updatedAt" Id="UpdatedAt" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" HelpText="The Timestamp when the list was created.">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedAt))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="createdAt" Id="CreatedAt" Converter="Long"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactsInList" Title="Contacts in List" Hidden="false" HelpText="Returns a list of contacts registered in a particular list.">
    <Parameters>
      <Text Id="ListId" Title="List Id" Debug.DefaultValue="1" HelpText="" Required="true"/>
      <Checkbox Id="ReturnRecent" Title="Return Recently Added Only" DefaultValue="false"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="VidOffset" Expr="vid-offset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/contacts/v1/lists/
        @(Model.ListId)/contacts/
        @if(Model.ReturnRecent == false)
        {
          @: all
        }
        else
        {
          @: recent
        }
        ?hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0)
        {
          @: &vidOffset=@(Model.VidOffset && Model.HasMore == "true")
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="contacts.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties.firstname.value" Id="FirstName" Title="First Name" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.lastname.value" Id="LastName" Title="Last Name" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties.company.value" Id="Company" Title="Company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.lastmodifieddate.value" Id="LastModified" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonical-vid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
        <JsonPath Expr="profile-url" Id="ProfileUrl" Title="Profile URL" Converter="String" HelpText="A URL that can be used to view the contact data without logging in. Anyone with this link would be able to view (but not edit) the record"/>
        <Compute Id="MergedIds" Title="Merged Ids"  Converter="String" HelpText="A list of vids that have been merged into this contact record." Checked="false">
          <Compute.Expr>
            <![CDATA[
            @{
              var temp = Regex.Replace(Model.MergedIds, @"\s+", " ");
              var stripped = temp.Substring(1,temp.Length-2);
            }
            @stripped
            ]]>
          </Compute.Expr>
        <JsonPath Expr="merged-vids" Id="MergedIds" Converter="String"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="Properties" Title="Properties" Hidden="false" HelpText="Returns a list of object properties.">
    <Parameters>
      <Radio Id="Type" Title="Return Properties of" DefaultValue="contacts" Required="false">
        <DataSource>
          <Item Id="contacts" Title="Contacts"/>
          <Item Id="companies" Title="Companies"/>
          <Item Id="deals" Title="Deals"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/properties/v1/
        @(Model.Type)/properties
        ?hapikey=@(Model.AccessToken)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="The internal name of the property."/>
        <JsonPath Expr="label" Id="Label" Title="Label" Converter="String" HelpText="A human readable label for the proeprty."/>
        <JsonPath Expr="description" Id="Description" Title="Description" Converter="String" HelpText="A description of the property."/>
        <JsonPath Expr="groupName" Id="GroupName" Title="Group Name" Converter="String" HelpText="The property group that the property belongs to."/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String" HelpText="One of string, number, date, datetime, or enumeration"/>
        <JsonPath Expr="fieldType" Id="FieldType" Title="Field Type" Converter="String" HelpText="Controls how the property appears in a form when the property is used as a form field."/>
        <JsonPath Expr="readOnlyValue" Id="ReadOnly" Title="ReadOnly" Converter="Bool" HelpText="A value of true means that the value cannot be set manually, and that only the HubSpot system can update the property."/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>


  <RestConnector Id="Companies" Title="Companies" Hidden="false" HelpText="Returns all companies that have been created in the portal.">
    <Parameters>
      <Radio Id="ReturnType" Title="Return" DefaultValue="all" Required="false">
        <DataSource>
          <Item Id="all" Title="All Companies"/>
          <Item Id="modified" Title="Recently Modified"/>
          <Item Id="created" Title="Recently Created"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="Offset" Expr="offset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/companies/v2/companies/
        @if(Model.ReturnType == "all")
        {
          @: paged?properties=@SelectedCompanyDealsFields()&
        }
        else
        {
          @: recent/@(Model.ReturnType)?
        }
        hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0  && Model.HasMore == "true")
        {
          @: &offset=@(Model.Offset)
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="@(FetchCompanyPath()).*">
        <JsonPath Expr="companyId" Id="CompanyId" Title="Company Id" Converter="Int" HelpText="The internal ID of the company."/>
        <JsonPath Expr="properties.name.value" Id="Name" Title="Name" Tag="name" Converter="String" HelpText="The name of the company." DefaultValue=""/>
        <JsonPath Expr="properties.num_associated_contacts.value" Id="Contacts" Title="Contacts" Tag="num_associated_contacts" Converter="Int" HelpText="Number of associated contacts." DefaultValue=""/>
        <JsonPath Expr="properties.num_notes.value" Id="Notes" Title="Notes" Tag="num_notes" Converter="Int" HelpText="Number of notes." DefaultValue=""/>
        <JsonPath Expr="properties.num_associated_deals.value" Id="Deals" Title="Deals" Tag="num_associated_deals" Converter="Int" HelpText="Number of associated deals." DefaultValue=""/>
        <JsonPath Expr="properties.description.value" Id="Description" Title="Description" Tag="description" Converter="String" HelpText="The description of the company." DefaultValue=""/>
        <JsonPath Expr="properties.industry.value" Id="Industry" Title="Industry" Converter="String" Tag="industry" HelpText="The industry of the company." DefaultValue=""/>
        <JsonPath Expr="properties.domain.value" Id="Domain" Title="Domain" Converter="String" Tag="domain" HelpText="The domain of the company." DefaultValue=""/>
        <JsonPath Expr="properties.website.value" Id="Website" Title="Website" Converter="String" Tag="website" HelpText="The website of the company." DefaultValue=""/>
        <JsonPath Expr="properties.country.value" Id="Country" Title="Country" Converter="String" Tag="country" HelpText="The country of the company." DefaultValue=""/>
        <JsonPath Expr="properties.city.value" Id="City" Title="City" Converter="String" Tag="city" HelpText="The city of the company." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="CompaniesbyDomain" Title="Companies by Domain" Hidden="false" HelpText="Returns a list of all companies that have a matching domain to the specified domai	.">
    <Parameters>
      <Text Id="Domain" Title="Domain" Debug.DefaultValue="jollo.se" HelpText="" Required="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/companies/v2/companies/domain/
        @Utils.UrlEncode(Utils.UrlProperty(Model.Domain).Domain)
        ?hapikey=@(Model.AccessToken)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="companyId" Id="CompanyId" Title="Company Id" Converter="Int" HelpText="The internal ID of the company."/>
        <JsonPath Expr="properties.name.value" Id="Name" Title="Name" Converter="String" HelpText="The name of the company." DefaultValue=""/>
        <JsonPath Expr="properties.num_associated_contacts.value" Id="Contacts" Title="Contacts" Converter="Int" HelpText="Number of associated contacts." DefaultValue=""/>
        <JsonPath Expr="properties.num_notes.value" Id="Notes" Title="Notes" Converter="Int" HelpText="Number of notes." DefaultValue=""/>
        <JsonPath Expr="properties.description.value" Id="Description" Title="Description" Converter="String" HelpText="The description of the company." DefaultValue=""/>
        <JsonPath Expr="properties.industry.value" Id="Industry" Title="Industry" Converter="String" HelpText="The industry of the company." DefaultValue=""/>
        <JsonPath Expr="properties.domain.value" Id="Domain" Title="Domain" Converter="String" HelpText="The domain of the company." DefaultValue=""/>
        <JsonPath Expr="properties.website.value" Id="Website" Title="Website" Converter="String" HelpText="The website of the company." DefaultValue=""/>
        <JsonPath Expr="properties.country.value" Id="Country" Title="Country" Converter="String" HelpText="The country of the company." DefaultValue=""/>
        <JsonPath Expr="properties.city.value" Id="City" Title="City" Converter="String" HelpText="The city of the company." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="ContactsInCompany" Title="Contacts in Company" Hidden="false" HelpText="Returns all of the contacts who are associated with the company.">
    <Parameters>
      <Text Id="CompanyId" Title="Company Id" Debug.DefaultValue="117000871" HelpText="" Required="true"/>
    </Parameters>
    <Paging PageSize="100">
      <Parse>
        <JsonPath Id="VidOffset" Expr="vidOffset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/companies/v2/companies/
        @(Model.CompanyId)/contacts/
        ?hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0 && Model.HasMore == "true")
        {
          @: &vidOffset=@(Model.VidOffset)
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="contacts.*">
        <JsonPath Expr="vid" Id="ContactId" Title="Contact Id" Converter="Int" HelpText="The internal ID of the contact record"/>
        <JsonPath Expr="properties[?(@@.name=='firstname')]value" Id="FirstName" Title="First Name" Converter="String" HelpText="First name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties[?(@@.name=='lastname')].value" Id="LastName" Title="Last Name" Converter="String" HelpText="Last name of the contact." DefaultValue=""/>
        <JsonPath Expr="properties[?(@@.name=='company')].value" Id="Company" Title="Company" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <JsonPath Expr="identity-profiles[*].identities[?(@@.type=='EMAIL')].value" Id="Email" Title="Email" Converter="String" HelpText="Company of the contact." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when contact was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModified))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties[?(@@.name=='lastmodifieddate')].value" Id="LastModified" Converter="Long"/>
        </Compute>
        <JsonPath Expr="canonicalVid" Id="ContactIdCanon" Title="Contact Id Canon" Converter="Int" HelpText="Contacts may have multiple vids, but the canonical-vid will be the primary ID for a record."/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="Deals" Title="Deals" Hidden="false" HelpText="Returns all deals that have been created in the portal.">
    <Parameters>
      <Radio Id="ReturnType" Title="Return" DefaultValue="all" Required="false">
        <DataSource>
          <Item Id="all" Title="All Deals"/>
          <Item Id="modified" Title="Recently Modified"/>
          <Item Id="created" Title="Recently Created"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Paging PageSize="100">
      <Parse>
        <JsonPath Id="Offset" Expr="offset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/deals/v1/deal/
        @if(Model.ReturnType == "all")
        {
          @: paged?properties=@SelectedDealsFields()&
        }
        else
        {
          @: recent/@(Model.ReturnType)?
        }
        hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0 && Model.HasMore == "true")
        {
          @: &offset=@(Model.Offset)
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="@(FetchDealPath()).*">
        <JsonPath Expr="dealId" Id="DealId" Title="Deal Id" Converter="Int" HelpText="The internal ID of the deal."/>
        <JsonPath Expr="properties.dealname.value" Id="Name" Title="Name" Tag="dealname" Converter="String" HelpText="The name of the deal." DefaultValue=""/>
        <JsonPath Expr="properties.amount.value" Id="Amount" Title="Amount" Tag="amount" Converter="Double" HelpText="The amount of the deal." DefaultValue="0"/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" Tag="hs_lastmodifieddate" HelpText="The Timestamp when deal was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModifiedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.hs_lastmodifieddate.value" Id="LastModifiedInput" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" Tag="createdate" HelpText="The Timestamp when deal was created" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.createdate.value" Id="CreatedInput" Converter="Long"/>
        </Compute>
        <JsonPath Expr="properties.num_associated_contacts.value" Id="Contacts" Title="Contacts" Tag="num_associated_contacts" Converter="Int" HelpText="Number of associated contacts." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="DealsAssociated" Title="Deals Associated" Hidden="false" HelpText="Returns all of the deals associated with a contact or company.">
    <Parameters>
      <Radio Id="AssociatedType" Title="Associated With" DefaultValue="contact" Required="false">
        <DataSource>
          <Item Id="contact" Title="Contact"/>
          <Item Id="company" Title="Company"/>
        </DataSource>
      </Radio>
      <Text Id="ObjectId" Title="Contact/Company Id" Debug.DefaultValue="204727" HelpText="" Required="true"/>
    </Parameters>
    <Paging PageSize="100">
      <Parse>
        <JsonPath Id="Offset" Expr="offset"/>
        <JsonPath Id="HasMore" Expr="hasMore"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/deals/v1/deal/associated/
        @(Model.AssociatedType)/
        @(Model.ObjectId)/
        paged?properties=@SelectedCompanyDealsFields()
        &hapikey=@(Model.AccessToken)
        &count=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0 && Model.HasMore == "true")
        {
          @: &offset=@(Model.Offset)
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="deals.*">
        <JsonPath Expr="dealId" Id="DealId" Title="Deal Id" Converter="Int" HelpText="The internal ID of the deal."/>
        <JsonPath Expr="properties.dealname.value" Id="Name" Title="Name" Tag="dealname" Converter="String" HelpText="The name of the deal." DefaultValue=""/>
        <JsonPath Expr="properties.amount.value" Id="Amount" Title="Amount" Tag="amount" Converter="Double" HelpText="The amount of the deal." DefaultValue="0"/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" Tag="hs_lastmodifieddate" HelpText="The Timestamp when deal was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModifiedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.hs_lastmodifieddate.value" Id="LastModifiedInput" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" Tag="createdate" HelpText="The Timestamp when deal was created" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="properties.createdate.value" Id="CreatedInput" Converter="Long"/>
        </Compute>
        <JsonPath Expr="properties.num_associated_contacts.value" Id="Contacts" Title="Contacts" Tag="num_associated_contacts" Converter="Int" HelpText="Number of associated contacts." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="DealsPipelines" Title="Deals Pipelines" Hidden="false" HelpText="Returns all deal pipelines for a given portal.">
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/deals/v1/pipelines
        ?hapikey=@(Model.AccessToken)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="pipelineId" Id="PipelineId" Title="Pipeline Id" Converter="String" HelpText="The internal ID of the pipeline."/>
        <JsonPath Expr="label" Id="PipelineLabel" Title="Pipeline Label" Converter="String" HelpText="The name of the pipeline."/>
        <JsonPath Expr="active" Id="PipelineActive" Title="Pipeline Active" Converter="Bool" HelpText="The activity status of the pipeline."/>
        <JsonPath Expr="stages[0].label" Id="Stage0Label" Title="Stage 1 Label" Converter="String" HelpText="Stage 1 name." DefaultValue=""/>
        <JsonPath Expr="stages[0].probability" Id="Stage0Probability" Title="Stage 1 Probability" Converter="String" HelpText="Stage 1 probability." DefaultValue=""/>
        <JsonPath Expr="stages[0].closedWon" Id="Stage0ClosedWon" Title="Stage 1 Closed" Converter="String" HelpText="Stage 1 closed and won." DefaultValue=""/>
        <JsonPath Expr="stages[1].label" Id="Stage1Label" Title="Stage 2 Label" Converter="String" HelpText="Stage 2 name." DefaultValue=""/>
        <JsonPath Expr="stages[1].probability" Id="Stage1Probability" Title="Stage 2 Probability" Converter="String" HelpText="Stage 2 probability." DefaultValue=""/>
        <JsonPath Expr="stages[1].closedWon" Id="Stage1ClosedWon" Title="Stage 2 Closed" Converter="String" HelpText="Stage 2 closed and won." DefaultValue=""/>
        <JsonPath Expr="stages[2].label" Id="Stage2Label" Title="Stage 3 Label" Converter="String" HelpText="Stage 3 name." DefaultValue=""/>
        <JsonPath Expr="stages[2].probability" Id="Stage2Probability" Title="Stage 3 Probability" Converter="String" HelpText="Stage 3 probability." DefaultValue=""/>
        <JsonPath Expr="stages[2].closedWon" Id="Stage2ClosedWon" Title="Stage 3 Closed" Converter="String" HelpText="Stage 3 closed and won." DefaultValue=""/>
        <JsonPath Expr="stages[3].label" Id="Stage3Label" Title="Stage 4 Label" Converter="String" HelpText="Stage 4 name." DefaultValue=""/>
        <JsonPath Expr="stages[3].probability" Id="Stage3Probability" Title="Stage 4 Probability" Converter="String" HelpText="Stage 4 probability." DefaultValue=""/>
        <JsonPath Expr="stages[3].closedWon" Id="Stage3ClosedWon" Title="Stage 4 Closed" Converter="String" HelpText="Stage 4 closed and won." DefaultValue=""/>
        <JsonPath Expr="stages[4].label" Id="Stage4Label" Title="Stage 5 Label" Converter="String" HelpText="Stage 5 name." DefaultValue=""/>
        <JsonPath Expr="stages[4].probability" Id="Stage4Probability" Title="Stage 5 Probability" Converter="String" HelpText="Stage 5 probability." DefaultValue=""/>
        <JsonPath Expr="stages[4].closedWon" Id="Stage4ClosedWon" Title="Stage 5 Closed" Converter="String" HelpText="Stage 5 closed and won." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>


  <RestConnector Id="Keywords" Title="Keywords" Hidden="false" HelpText="Returns all keywords that have been created in the portal.">
    <Parameters>
      <Text Id="Query" Title="Optional Keyword Search Query" Debug.DefaultValue="inbound" Required="false"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/keywords/v1/keywords
        ?hapikey=@(Model.AccessToken)
        @if(!string.IsNullOrEmpty(Model.Query))
        {
          @: &search=@(Utils.UrlEncode(Model.Query))
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.keywords.*">
        <JsonPath Expr="keyword" Id="Keyword" Title="Keyword" Converter="String" HelpText="The name of the keyword."/>
        <Compute Id="Created" Title="Created" Converter="DateTime" HelpText="The Timestamp when keyword was created" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="created_at" Id="CreatedInput" Converter="Long"/>
        </Compute>
        <JsonPath Expr="visits" Id="Visits" Title="Visits" Converter="Int" HelpText="Number of visits."/>
        <JsonPath Expr="contacts" Id="Contacts" Title="Contacts" Converter="Int" HelpText="Number of contacts."/>
        <JsonPath Expr="leads" Id="Leads" Title="Leads" Converter="Int" HelpText="Number of leads."/>
        <JsonPath Expr="keyword_guid" Id="KeywordId" Title="Keyword Id" Converter="String" HelpText="The Id of the keyword." Checked="false"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="Owners" Title="Owners" Hidden="false" HelpText="Returns all of the owners that exist inside of HubSpot.">
    <Parameters>
      <Text Id="Email" Title="Optional Email Adress Filter" Debug.DefaultValue="" Required="false"/>
      <Checkbox Id="IncludeInactiveOwners" Title="Include Inactive Owners" DefaultValue="false"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.hubapi.com/owners/v2/owners
        ?hapikey=@(Model.AccessToken)
        @if(!string.IsNullOrEmpty(Model.Email))
        {
          @: &email=@(Utils.UrlEncode(Model.Email))
        }
        @if(Model.IncludeInactiveOwners != false)
        {
          @: &includeInactive=true
        }
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="ownerId" Id="OwnerId" Title="Owner Id" Converter="Int" HelpText="The Id of the owner."/>
        <JsonPath Expr="firstName" Id="FirstName" Title="First Name" Converter="String" HelpText="The first name of the owner." DefaultValue=""/>
        <JsonPath Expr="lastName" Id="LastName" Title="Last Name" Converter="String" HelpText="The last name of the owner." DefaultValue=""/>
        <JsonPath Expr="email" Id="Email" Title="Email" Converter="String" HelpText="The email of the owner." DefaultValue=""/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String" HelpText="The owner type."/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when owner was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModifiedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="updatedAt" Id="LastModifiedInput" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" HelpText="The Timestamp when owner was registered" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="createdAt" Id="CreatedInput" Converter="Long"/>
        </Compute>
        <JsonPath Expr="hasContactsAccess" Id="ContactAccess" Title="Contact Access" Converter="Bool" HelpText="If the owner has access to contacts."/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="Workflows" Title="Workflows" Hidden="false" HelpText="Returns all workflows that have been created in the portal.">
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.hubapi.com/automation/v3/workflows/
        ?hapikey=@(Model.AccessToken)
        ]]>
        </Fetch.Url>
      </Fetch>
    <Parse>
      <JsonPath Expr="$.workflows.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int" HelpText="The Id of the workflow."/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="The name of the workflow." DefaultValue=""/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String" HelpText="The workflow type." DefaultValue=""/>
        <Compute Id="LastModified" Title="Last Modified" Converter="DateTime" HelpText="The Timestamp when workflow was last modified" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.LastModifiedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="updatedAt" Id="LastModifiedInput" Converter="Long"/>
        </Compute>
        <Compute Id="Created" Title="Created" Converter="DateTime" HelpText="The Timestamp when workflow was registered" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
            @(DateTimeOffset.FromUnixTimeMilliseconds(Model.CreatedInput))
            ]]>
          </Compute.Expr>
          <JsonPath Expr="insertedAt" Id="CreatedInput" Converter="Long"/>
        </Compute>
        <JsonPath Expr="contactListIds.enrolled" Id="EnrolledContacts" Title="Enrolled Contacts" Converter="Int" HelpText="Number of enrolled contacts in the workflow." DefaultValue="0"/>
        <JsonPath Expr="contactListIds.active" Id="ActiveContacts" Title="Active Contacts" Converter="Int" HelpText="Number of active contacts in the workflow." DefaultValue="0"/>
        <JsonPath Expr="enabled" Id="Enabled" Title="Enabled" Converter="String" HelpText="if the workflow is enabled." DefaultValue=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="message"/>
    </Fail>
  </RestConnector>

  <RazorFunctions>
  <![CDATA[
  string FetchContactIdString()
  {
    string[] lines = ((string)Model.ContactIds).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(100).ToArray();
    return string.Join("&vid=",lines.Select((e, i) => Utils.UrlEncode(e)).ToArray());
  }
  string FetchContactEmailString()
  {
    string[] lines = ((string)Model.ContactEmails).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(100).ToArray();
    return string.Join("&email=",lines.Select((e, i) => Utils.UrlEncode(e)).ToArray());
  }
  string FetchContactListString()
  {
    string[] lines = ((string)Model.ContactListsIds).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(100).ToArray();
    return string.Join("&listId=",lines.Select((e, i) => Utils.UrlEncode(e)).ToArray());
  }
  string FetchCompanyPath()
  {
    if(Model.ReturnType == "all")
    {
      return "companies";
    }
    else
    {
      return "results";
    }
  }
  string FetchDealPath()
  {
    if(Model.ReturnType == "all")
    {
      return "deals";
    }
    else
    {
      return "results";
    }
  }
  string SelectedCompanyDealsFields()
  {
    string[] fields = ((string)Model.Fields).Split(',').Select(e => e.Trim().ToLower()).ToArray();
    return string.Join("&properties=",((ResultField[])Model.Headers).Where(e => !string.IsNullOrEmpty(e.Tag) && fields.Contains(e.Identifier.ToLower())).Select(e => e.Tag).ToArray());
  }
  string SelectedContactFields()
  {
    string[] fields = ((string)Model.Fields).Split(',').Select(e => e.Trim().ToLower()).ToArray();
    return string.Join("&property=",((ResultField[])Model.Headers).Where(e => !string.IsNullOrEmpty(e.Tag) && fields.Contains(e.Identifier.ToLower())).Select(e => e.Tag).ToArray());
  }
    string SelectedDealsFields()
  {
    string[] fields = ((string)Model.Fields).Split(',').Select(e => e.Trim().ToLower()).ToArray();
    return string.Join("&properties=",((ResultField[])Model.Headers).Where(e => !string.IsNullOrEmpty(e.Tag) && fields.Contains(e.Identifier.ToLower())).Select(e => e.Tag).ToArray());
  }
  ]]>
  </RazorFunctions>

</Suite>